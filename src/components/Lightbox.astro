---
interface Props {}
---

<div id="lightbox" class="lightbox" role="dialog" aria-modal="true" aria-label="Media viewer" hidden>
	<div class="lightbox__backdrop" data-lightbox-close></div>
	<div class="lightbox__content">
		<button type="button" class="lightbox__close" data-lightbox-close aria-label="Close">
			<span aria-hidden="true">Ã—</span>
		</button>
		<div class="lightbox__media">
			<img class="lightbox__img" src="" alt="" />
			<iframe class="lightbox__iframe" title="Video" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
		</div>
	</div>
</div>

<style>
	.lightbox {
		position: fixed;
		inset: 0;
		z-index: 10000;
		display: flex;
		align-items: center;
		justify-content: center;
		padding: 24px;
		animation: lightbox-fade-in 0.2s ease-out;
	}

	.lightbox[hidden] {
		display: none !important;
	}

	@keyframes lightbox-fade-in {
		from {
			opacity: 0;
		}
		to {
			opacity: 1;
		}
	}

	.lightbox__backdrop {
		position: absolute;
		inset: 0;
		background: rgba(0, 0, 0, 0.85);
		cursor: pointer;
	}

	.lightbox__content {
		position: relative;
		max-width: 95vw;
		max-height: 90vh;
		display: flex;
		align-items: center;
		justify-content: center;
	}

	.lightbox__close {
		position: absolute;
		top: -48px;
		right: 0;
		width: 40px;
		height: 40px;
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 32px;
		line-height: 1;
		color: #fff;
		background: transparent;
		border: none;
		cursor: pointer;
		z-index: 1;
	}

	.lightbox__close:hover {
		opacity: 0.8;
	}

	.lightbox__media {
		position: relative;
		display: flex;
		align-items: center;
		justify-content: center;
	}

	.lightbox__img {
		max-width: 100%;
		max-height: 85vh;
		width: auto;
		height: auto;
		display: block;
	}

	.lightbox__img[hidden],
	.lightbox__iframe[hidden] {
		display: none !important;
	}

	.lightbox__iframe {
		width: 90vw;
		max-width: 900px;
		height: 50.625vw;
		max-height: 506.25px;
		border: none;
	}
</style>

<script>
	function initLightbox() {
		const lightbox = document.getElementById('lightbox');
		const img = lightbox?.querySelector('.lightbox__img');
		const iframe = lightbox?.querySelector('.lightbox__iframe');
		if (!lightbox || !img || !iframe) return;

		function showImage(src: string, alt: string) {
			img.setAttribute('src', src);
			img.setAttribute('alt', alt || '');
			img.hidden = false;
			iframe.hidden = true;
			iframe.removeAttribute('src');
			lightbox.hidden = false;
			document.body.style.overflow = 'hidden';
		}

		function showVideo(src: string, title: string) {
			iframe.setAttribute('src', src);
			iframe.setAttribute('title', title || 'Video');
			iframe.hidden = false;
			img.hidden = true;
			img.removeAttribute('src');
			lightbox.hidden = false;
			document.body.style.overflow = 'hidden';
		}

		function close() {
			lightbox.hidden = true;
			img.removeAttribute('src');
			iframe.removeAttribute('src');
			document.body.style.overflow = '';
		}

		document.addEventListener('click', (e) => {
			const target = e.target as Element;
			const trigger = target.closest('[data-lightbox]');
			if (trigger) {
				e.preventDefault();
				const src = trigger.getAttribute('data-lightbox-src');
				const type = trigger.getAttribute('data-lightbox-type') || 'image';
				const alt = trigger.getAttribute('data-lightbox-alt') ?? '';
				const title = trigger.getAttribute('data-lightbox-title') ?? '';
				if (!src) return;
				if (type === 'video') showVideo(src, title);
				else showImage(src, alt);
				return;
			}
			// Raw <img> in article body (e.g. MDX)
			if (target.tagName === 'IMG' && target.closest('.article__body')) {
				e.preventDefault();
				const src = (target as HTMLImageElement).src;
				const alt = (target as HTMLImageElement).alt ?? '';
				if (src) showImage(src, alt);
			}
		});

		lightbox.querySelectorAll('[data-lightbox-close]').forEach((el) => {
			el.addEventListener('click', close);
		});

		document.addEventListener('keydown', (e) => {
			if (e.key === 'Escape' && !lightbox.hidden) close();
		});
	}

	initLightbox();
</script>
